## このプロジェクトについて

このプロジェクトは、画面に表示している画像をに対して以下の動作を実現しています

・ズームイン、ズームアウト
・パン(1本指、2本指)

目標として、2本指でズームイン・ズームアウトをすると思います。このときに、2本の指の中心を中心にして画像のズームイン・ズームアウトができるようにしています。
この動作はきちんと実装しないと実現できなかった部分です。

## 実際に動かしたときの動画


## 学んだこと・注意点(あれば)

タップイベントで今回のような細かい動きを実現したい場合は、UIViewまでアクセスする必要があるので、SwiftUIだけでは完結しなくなる

### タップイベントのハンドリングいついて

指の本数やピンチなのかパンなのかどの動きをユーザーがしようとしているのかの判定自体は、システムが行ってくれるので、このプロジェクトではシンプルにこの動作の場合はこう動かすのような、ハンドリングをすることを意識すればいい

以下のRecognizerを生成して、デリゲートに処理を渡すことで実現している(ZoomPanUIView)

- ピンチ : UIPinchGestureRecognizer
- パン : UIPanGestureRecognizer

ちなみに、UIPinchGestureRecognizerのlocalPositionで取得できる座標は、2本指のView上の中心座標になる
View上というのが肝で、イメージ上の座標にはなっていないので注意が必要

### アンカーポイント

アンカーポイントは画像やUIパーツのどこを中心とするかを決めるもので、どんなに大きなUIパーツであっても、0 ~ 1の間で正規化された数値になる。

デフォルトでは、( 0.5,0.5 )になっているので、注意しないと、想定と違う位置に画像やUIパーツが動いてしまう

### 2本指の中心でズームイン・ズームアウトさせる

UIPinchGestureRecognizer.localPositionから取得できる座標は、View上の中心座標だが、Image上の座標ではないので、Image上のどこを中心としたいのかを計算する必要がある

画像を拡大縮小すると、画像のアンカーポイントを基準に拡大縮小されてしまいます。
なので、画像上の点と画面上の点を重ねる考え方が必要です。

画像の特定の座標が画面上ではどの座標として写っているのかを計算する式が以下のものになります。
(もちろん前提として、画面座標の上に画像座標がいる)

```bash
画面上の座標 = 画像上の座標 × 拡大率 + 平行移動量
```

この式を変形させて、画像上の座標を画面上の座標から導きたいので、以下のようになります。

```bash
画像上の座標 = (画面上の座標 − 平行移動量) ÷ 拡大率
```

これを、コードに落とし込んだのが以下になります。(ZoomPanUIView:112~115)

```swift
let anchorInImage = CGPoint(
  x: (anchorInView.x - translationBefore.x) / scaleBefore,
  y: (anchorInView.y - translationBefore.y) / scaleBefore
)
```

### Scaleの値は累積

Scaleの値は累積になってしまうので、毎フレームの相対数値になるようにしている

## どんなときに参考になるプロジェクトか

- ユーザーのタップ入力(複数指も)を受け取る方法の一番シンプルな方法を知りたい
- 画像のズームイン・ズームアウト機能を実装したい
    - 2本指の中心を中心にして動作させたい
- パン移動をしたい
    - 1本指・2本指のパン移動の有効無効を切り替えたい
